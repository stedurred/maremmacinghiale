<?phpconst STEDURRED = 'stedurred';session_start();if(isset($_SESSION['user']) && $_SESSION['user']!==STEDURRED){ header("Location: home.php");}include_once 'php/dbconnect.php';if(isset($_POST['btn-save'])){    $timezone = date_default_timezone_get(); //echo "The current server timezone is: " . $timezone; date_default_timezone_set($timezone); $datenow = date('Y-m-d H:i:s'); //echo $datenow; $uname = mysqli_real_escape_string($connection,$_POST['uname']); $email = mysqli_real_escape_string($connection,$_POST['email']); $upass = md5(mysqli_real_escape_string($connection,$_POST['pass'])); $regione= mysqli_real_escape_string($connection,$_POST['DropDownRegione']); $provincia= mysqli_real_escape_string($connection,$_POST['DropDownProvincia']); $atc= mysqli_real_escape_string($connection,$_POST['DropDownAtc']); $squadra= mysqli_real_escape_string($connection,$_POST['DropDownSquadre']); //echo '$_POST[canaio]:'.mysqli_real_escape_string($connection,$_POST['canaio']); $canaio = 0; if (isset($_POST['canaio']) and mysqli_real_escape_string($connection,$_POST['canaio'])=='on') {	 echo $_POST['canaio']; 	$canaio = 1; } echo 'canaio:'.$canaio; //echo '$_POST[capocaccia]:'.mysqli_real_escape_string($connection,$_POST['capocaccia']); $capocaccia = 0; if (isset($_POST['capocaccia']) and mysqli_real_escape_string($connection,$_POST['capocaccia'])=='on') { 	$capocaccia = 1; } echo 'capocaccia:'.$capocaccia; //echo '$_POST[admin_squadra]:'.mysqli_real_escape_string($connection,$_POST['admin_squadra']); $admin_squadra = 0;    $admin_page = 0;    if (isset($_POST['admin_squadra']) and mysqli_real_escape_string($connection,$_POST['admin_squadra'])=='on') {        $admin_squadra = 1;    }    echo 'admin_squadra:'.$admin_squadra;    if (isset($_POST['admin_page']) and mysqli_real_escape_string($connection,$_POST['admin_page'])=='on') {        $admin_page = 1;    }    echo 'admin_page:'.$admin_page; //$canaio= mysqli_real_escape_string($connection,$_POST['canaio'])=='on'?true:false; //$capocaccia = false; //$capocaccia= mysqli_real_escape_string($connection,$_POST['capocaccia'])=='on'?true:false; //$admin_squadra = false; //$admin_squadra= mysqli_real_escape_string($connection,$_POST['admin_squadra']=='on'?true:false);   $error_types = array(    0 => 'There is no error, the file uploaded with success',    1 => 'The uploaded file exceeds the upload_max_filesize directive in php.ini',    2 => 'The uploaded file exceeds the MAX_FILE_SIZE directive that was specified in the HTML form',    3 => 'The uploaded file was only partially uploaded',    4 => 'No file was uploaded',    6 => 'Missing a temporary folder',    7 => 'Failed to write file to disk.',    8 => 'A PHP extension stopped the file upload.');   $uploaddir = './uploads/'; $file      = $_FILES['img_profilo']; $name      = $file['name']; $tmp_name  = $file['tmp_name']; $error     = $file['error']; $uploadfile = $uploaddir.basename($name);if ($file == null){    if ($error == UPLOAD_ERR_OK){     echo "File is valid, and was successfully uploaded.\n";          if (move_uploaded_file($tmp_name, $uploadfile)) {              $msg .= "Immagine del profilo '".$tmp_name."' aggiornata '".$name."'<br/>\n";          } else {            $errormsg .= "Could not move uploaded file '".$tmp_name."' to '".$name."'<br/>\n";          }    }else $errormsg .= "Upload error on file '".$name."'<br/>\n".$error_types[$error];}    /*Codice che inserisce lo User nel DB*/    if($_SESSION['user']== STEDURRED ){        $sql = "INSERT INTO users(username,email,password,trn_date,url_foto,id_atc,id_squadra,capocaccia,canaio,admin_page,admin_squadra)                VALUES('$uname','$email','$upass','$datenow','$uploadfile',$atc,'$squadra', $capocaccia,$canaio,$admin_page, $admin_squadra )                ON DUPLICATE KEY UPDATE username='$uname',        								password='$upass',        								trn_date='$datenow',        								url_foto='$uploadfile',        								id_atc='$atc',        								id_squadra='$squadra',        								capocaccia=$capocaccia,        								canaio=$canaio,         								admin_squadra=$admin_squadra,        								admin_page=$admin_page";        echo $sql;                /*2		2147483647		Stefano Durante		stedurred@gmail.com		Stefano		Durante		EAAM03PcZABZBcBABuU7sZAuqt9ZCPK5ZB3sBx1P5NFT4PZB7r...		299		20		stedurred		stedurred@gmail.com		81b3ef96181a69bc7d10ea89789b789c		2016-08-11 00:46:50		./uploads/20160110_122448.jpg		0		0		NULL*/        $result=mysqli_query($connection,$sql);        if ($error == UPLOAD_ERR_OK){            echo "File is valid, and was successfully uploaded.\n";            if (move_uploaded_file($tmp_name, $uploadfile)) {                $msg = "Immagine del profilo '".$tmp_name."' aggiornata '".$name."'<br/>\n";            } else {                $errormsg .= "Could not move uploaded file '".$tmp_name."' to '".$name."'<br/>\n";            }        }else $errormsg .= "Upload error on file '".$name."'<br/>\n".$error_types[$error];    }else{        /*         * Controllo Utente         */        $sqlControlloUtente = "SELECT username,email FROM users WHERE email='$email'";        $resultControlloUtente=mysqli_query($connection,$sqlControlloUtente);        $row=mysqli_fetch_array($resultControlloUtente);        if (!empty($row)) {            if($row['username']=$uname){                $errormsg .= "<br/>\nErrore registrazione Utente: username utilizzata da un altro utente'".$uname."'<br/>\n".$error_types[E_USER_WARNING];                trigger_error(E_USER_WARNING);            }            if($row['email']=$email){                $errormsg .= "<br/>\nErrore registrazione Utente: email utilizzata da un altro utente'".$email."'<br/>\n".$error_types[E_USER_WARNING];                trigger_error(E_USER_WARNING);            }        }else{            /*             * Inserimento Utente             */            $sql = "INSERT INTO users(username,email,password,trn_date,url_foto,id_atc,id_squadra)                    VALUES('$uname','$email','$upass','$datenow','$uploadfile','$atc','$squadra')";            $result=mysqli_query($connection,$sql);        }    }/*$sql = "INSERT INTO users(username,email,password,trn_date,url_foto,id_atc,id_squadra) VALUES('$uname','$email','$upass','$datenow','$uploadfile','$atc','$squadra')";if($_SESSION['user']=='stedurred'){   $sql = "INSERT INTO users(username,email,password,trn_date,url_foto,id_atc,id_squadra) VALUES('$uname','$email','$upass','$datenow','$uploadfile',$atc,'$squadra')   ON DUPLICATE KEY UPDATE username='$uname',password='$upass',trn_date='$datenow',url_foto='$uploadfile',id_atc='$atc',id_squadra='$squadra'";}$result=mysqli_query($connection,$sql);*/}?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">    <head>        <meta http-equiv="content-type" content="text/html; charset=utf-8" />        <title>Maremma Cinghiale - Caccia al cinghiale nella Maremma Toscana</title>        <meta name="keywords" content="Maremma Cinghiale Caccia Toscana" />        <meta name="description" content="Maremma Cinghiale - Caccia al cinghiale nella Maremma Toscana un sito dove si posso trovare le varie squadre di caccia al cinghiale della maremma toscana" />           	          <script type="text/javascript" src="js/cufon-yui.js"></script>        <script type="text/javascript" src="js/28_Days_Later_400.font.js"></script>                <!-- Latest compiled and minified CSS -->		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">				<!-- jQuery library -->		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>				<!-- Latest compiled JavaScript -->		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>        		<!-- My CSS -->		<link href="css/styles.css" rel="stylesheet" type="text/css" media="screen" />				        <!--<script type="text/javascript" src="js/jquery-1.4.3.min.js"></script>        <script type="text/javascript" src="js/jquery.nivo.slider.pack.js"></script>        <link rel="stylesheet" href="css/nivo-slider.css" type="text/css" media="screen" />-->                <script type="text/javascript">           Cufon.replace("H1");           Cufon.replace("H2");           Cufon.replace("H3");           Cufon.replace("#top_padding a");           Cufon.replace("#menu a");        </script>    </head>    <body onload="getRegioni()">    	<noscript>This page requires JavaScript be available and enabled to function properly</noscript>		<!-- Codice Accettazione Cookie-->		<script type="text/javascript" src="js/cookiechoices.js"></script>		<!--consenso all'uso dei cookie-->		<script type="text/javascript">			document.addEventListener('DOMContentLoaded', function (event) {			cookieChoices.showCookieConsentBar('Questo sito fa uso di cookies. Continuando la navigazione se ne autorizza l\'uso.', 'OK', 'Piï¿½ info', 'maremmacinghiale.it/privacy.html');			});		</script>    	<script type="text/javascript" >        <!--Ready Ajax->            function readyAJAX() {                try {return new XMLHttpRequest();} catch(e) {                    try {return new ActiveXObject("Msxml2.XMLHTTP");} catch(e) {                        try {return new ActiveXObject("Microsoft.XMLHTTP");} catch(e) {                            return "A newer browser is needed.";                        }                    }                }            }        </script>				<div id="wrap">    		<div id="content_top"></div>							<div id="content_bg_repeat">				<div id="top_padding">					<a href="#">MAREMMA CINGHIALE</a>					<h3><a href="">Caccia al cinghiale nella Maremma Toscana</a></h3>				</div>								<nav class="navbar navbar-inverse">				   <div class="container-fluid">					 <div class="navbar-header">					   <a class="navbar-brand" href="http:\\www.maremmacinghiale.it">MaremmaCinghiale.it</a>					 </div>					 <ul class="nav navbar-nav">							<li><a href="http:\\www.maremmacinghiale.it" class="active">Home</a></li>							<li><a href="#">Blog</a></li>							<li><a href="#">Gallery</a></li>							<li><a href="#">About Us</a></li>							<li><a href="contact_us.php">Contattaci</a></li>					 </ul>				   </div>				</nav>             				<div id="content">					<div class="container">						<div class="row">							<div class="col-md-2 visible-md visible-lg visible-lg">								<h2 class="pad_bot1"><span class="label label-danger">User Admin Page</span></h2>								<p class="pad_bot1 color1 pad_top1"><span class="label label-default">Per registrarsi al sito maremmacinghiale.it basta riempire i campi sottostanti</span></p>								<p class="pad_bot3"><span class="label label-danger">Questo servizio permette a tutti i cacciatori delle varie squadre di caccia al cinghiale di registrarsi</span></p>							</div>						</div>													<form role="form-horizontal" method="post" enctype="multipart/form-data">													<div class="row">								<div class="col-md-2 visible-md visible-lg visible-lg">								</div>								<div class="col-md-8 col-xs-12">																	<div class="col-sm-4">										<div class="form-group">											<h1><label class="control-label col-sm-6" for="uname" title="User Name">User Name</label></h1>										</div>									</div>								   <div class="col-sm-8">									  <div class="form-group">										<input type="text" class="form-control" name="uname" placeholder="User Name" required />									  </div>								   </div>								</div>							</div>								<div class="row">								<div class="col-md-2 visible-md visible-lg visible-lg">								</div>								<div class="col-md-8 col-xs-12">																		<div class="col-sm-4">										<div class="form-group">											<h1><label class="control-label col-sm-6" for="email" title="Email">Email</label></h1>									   </div>								   </div>								   <div class="col-sm-8">									   <div class="form-group">											<input type="email" class="form-control" name="email" placeholder="Email" required />									   </div>								   </div>								</div>							</div>					  							<div class="row">								<div class="col-md-2 visible-md visible-lg visible-lg">								</div>								<div class="col-md-8 col-xs-12">																	<div class="col-sm-4">           										<div class="form-group">											<h1><label class="control-label col-sm-6" for="pass" title="Password">Password</label></h1>										</div>									</div>									<div class="col-sm-8">										<div class="form-group">											<input type="password" class="form-control" name="pass" placeholder="Password" required />										</div>								   </div>								</div>							</div>			  							<div class="row">								<div class="col-md-2 visible-md visible-lg visible-lg">								</div>								<div class="col-md-8 col-xs-12">																		<div class="col-sm-4">										<div class="form-group"><h1>											<label class="control-label col-sm-6" for="img_profilo" title="Immagine del profilo">Immagine del profilo</label></h1>										</div>									</div>									<div class="col-sm-8">									   <div class="form-group"><!-- MAX_FILE_SIZE deve precedere campo di input del nome file -->											<input type="hidden" name="MAX_FILE_SIZE" value="0" />											<input type="file" class="form-control" name="img_profilo" placeholder="Immagine del profilo" />									   </div>									</div>								</div>							</div>					  						  <div class="row">							<div class="col-md-2 visible-md visible-lg visible-lg">							</div>							<div class="col-md-8 col-xs-12">										<div class="col-sm-4">									 <div class="form-group"><h1>										<label class="control-label col-sm-6" for="DropDownRegione" title="Regione">Regione</label></h1>									 </div>								</div>							   <div class="col-sm-8">								  <div class="form-group">									 <select name = "DropDownRegione" id="ddregione"  class="form-control" onchange="getProvince(this)" onfocus="getProvince(this)" >										<option value="">Selezionare una Regione</option>									</select>								  </div>							   </div> 							</div>						 </div>					  						<div class="row">							<div class="col-md-2 visible-md visible-lg visible-lg">							</div>							<div class="col-md-8 col-xs-12">										<div class="col-sm-4">									 <div class="form-group"><h1>										<label class="control-label col-sm-6" for="DropDownProvincia" title="Provincia">Provincia</label></h1>									 </div>							   </div>							   <div class="col-sm-8">								  <div class="form-group">									 <select name = "DropDownProvincia" id="ddprovincia" class="form-control" onchange="getAtc(this)" onfocus="getAtc(this)" >										<option value="">Selezionare una Provincia</option>									</select>								  </div>							   </div>							</div>						</div>					  					  <div class="row">						 <div class="col-md-2 visible-md visible-lg visible-lg">						</div>						<div class="col-md-8 col-xs-12">													<div class="col-sm-4">								<div class="form-group"><h1>								  <label class="control-label col-sm-6" for="DropDownAtc" title="Ambito territoriale di caccia">A.T.C.</label></h1>								</div>						   </div>						   <div class="col-sm-8">							  <div class="form-group">								 <select name = "DropDownAtc" id="ddatc"  class="form-control" onchange="getSquadre(this)" >									 <option value="">Selezionare un A.T.C.</option>								   </select>							  </div>						   </div>					   </div>					 </div>					  					  <div class="row">						 <div class="col-md-2 visible-md visible-lg visible-lg">						</div>						<div class="col-md-8 col-xs-12">								<div class="col-sm-4">								<div class="form-group"><h1>									<label class="control-label col-sm-6" for="DropDownSquadre" title="Squadra cinghiale">Squadra cinghiale</label></h1>							   </div>						   </div>						   <div class="col-sm-8">							  <div class="form-group">								<select name = "DropDownSquadre" id="ddsquadre" class="form-control">									  <option value="">Selezionare una Squadra</option>								</select>							  </div>						   </div>						</div>					</div>										<div class="row">						<div class="col-md-2 visible-md visible-lg visible-lg">						</div>						<div class="col-md-8 col-xs-12">														<div class="col-sm-4">								<div class="form-group">									<h1><label class="control-label col-sm-6" for="capocaccia" title="Capocaccia">Capocaccia</label></h1>							   </div>						   </div>						   <div class="col-sm-8">							   <div class="form-group">									<input type="checkbox" class="form-control" name="capocaccia" placeholder="Capocaccia" />							   </div>						   </div>						</div>					</div>										<div class="row">						<div class="col-md-2 visible-md visible-lg visible-lg">						</div>						<div class="col-md-8 col-xs-12">														<div class="col-sm-4">								<div class="form-group">									<h1><label class="control-label col-sm-6" for="canaio" title="Canaio">Canaio</label></h1>							   </div>						   </div>						   <div class="col-sm-8">							   <div class="form-group">									<input type="checkbox" class="form-control" name="canaio" placeholder="Canaio" />							   </div>						   </div>						</div>					</div>															<div class="row">						<div class="col-md-2 visible-md visible-lg visible-lg">						</div>						<div class="col-md-8 col-xs-12">														<div class="col-sm-4">								<div class="form-group">									<h1><label class="control-label col-sm-6" for="admin_squadra" title="Admin Squadra">Admin Squadra</label></h1>							   </div>						   </div>						   <div class="col-sm-8">							   <div class="form-group">									<input type="checkbox" class="form-control" name="admin_squadra" placeholder="Admin Squadra" />							   </div>						   </div>						</div>					</div>					<div class="row">						<div class="col-md-2 visible-md visible-lg visible-lg">						</div>						<div class="col-md-8 col-xs-12">							<div class="col-sm-4">								<div class="form-group">									<h1><label class="control-label col-sm-6" for="admin_squadra" title="Admin Pagina Facebook">Admin Pagina Facebook</label></h1>								</div>							</div>							<div class="col-sm-8">								<div class="form-group">									<input type="checkbox" class="form-control" name="admin_page" placeholder="Admin Pagina Facebook" />								</div>							</div>						</div>					</div>			  					<div class="row">						 <div class="col-md-2 visible-md visible-lg visible-lg">						 </div>						<div class="col-md-8 col-xs-12">							<div class="col-sm-12">								<div class="form-group"><h1>									 <button class="btn btn-warning btn-lg" type="submit" name="btn-save" class="form-control">Salva</button>								</div>						   </div>						 </div>					 </div>                    <div class="row">                        <div class="col-md-2 visible-md visible-lg visible-lg">                        </div>                        <div class="col-md-8 col-xs-12">                            <div class="col-sm-12">                                <div class="form-group"><h1>                                        <button class="btn btn-warning btn-lg" type="submit" name="btn-search" class="form-control" onclick="getUtenti()">Cerca</button>                                </div>                            </div>                        </div>                    </div>					 <?php 						if(isset($_POST['btn-save'])){						 if(!isset($errormsg)){							print "<h2 class='pad_bot1 pad_top1'><span class='label label-default'>Registrazione avvenuta con successo</span></h2>"."\n".$msg;						 }else print "<h2 class='pad_bot1 pad_top1'><span class='label label-danger'>Errore registrazione</span></h2>"."\n".$errormsg;						}?>				</form>				<div id="listaUtenti">                </div>				<script type="text/javascript">                    function getUtenti(){                        //alert("PIPPO");                        var url = "getUtenti_admin.php";                        var ddatc = document.getElementById("ddatc").value;                        var ddprovincia = document.getElementById("ddprovincia").value;                        var ddregione = document.getElementById("ddregione").value;                        var ddsquadre = document.getElementById("ddsquadre").value;                        var requestObj = readyAJAX();                        var params = "id_atc="+encodeURIComponent(ddatc)+"&id_regione="+encodeURIComponent(ddregione)+"&id_provincia="+encodeURIComponent(ddprovincia)+"&id_squadra="+encodeURIComponent(ddsquadre);                        requestObj.open("POST",url,true);                        requestObj.setRequestHeader("Content-type", "application/x-www-form-urlencoded");                        requestObj.send(params);                        requestObj.onreadystatechange = function() {                            if (requestObj.readyState == 4) {                                if (requestObj.status == 200) {                                    document.getElementById("listaUtenti").innerHTML = requestObj.responseText;                                    alert(requestObj.responseText);                                } else {                                    alert(requestObj.statusText);                                }                            }                        }                    }                </script>				</div> 			</div> 		<div id="content_bottom"></div>		</div>					<script type="text/javascript">            //Codice cambio Regione richiesta province                           function getRegioni(){                  var url = "getRegioni.php";                   //var e = document.getElementById("ddregione");                  var requestObj = readyAJAX();                   //var strIdRegione =select.value;                                    //var params = "id_regione="+encodeURIComponent(strIdRegione);                   requestObj.open("POST",url,true);                   requestObj.setRequestHeader("Content-type", "application/x-www-form-urlencoded");                   requestObj.send();                   requestObj.onreadystatechange = function() {                     if (requestObj.readyState == 4) {                        if (requestObj.status == 200) {                              document.getElementById("ddregione").innerHTML = requestObj.responseText;                              //alert(requestObj.responseText);                        } else {                           alert(requestObj.statusText);                        }                     }                  }               }               function getProvince(select){                  var url = "getProvince.php";                  var e = document.getElementById("ddregione");                  var requestObj = readyAJAX();                   var strIdRegione =select.value;                                    var params = "id_regione="+encodeURIComponent(strIdRegione);                   requestObj.open("POST",url,true);                   requestObj.setRequestHeader("Content-type", "application/x-www-form-urlencoded");                   requestObj.send(params);                   requestObj.onreadystatechange = function() {                     if (requestObj.readyState == 4) {                        if (requestObj.status == 200) {                              document.getElementById("ddprovincia").innerHTML = requestObj.responseText;                              //alert(requestObj.responseText);                        } else {                           alert(requestObj.statusText);                        }                     }                  }               }                              function getAtc(select){                  var url = "getAtc.php";                   var e = document.getElementById("ddprovincia");                  var requestObj = readyAJAX();                   var strIdProvincia =select.value;                                    var params = "id_provincia="+encodeURIComponent(strIdProvincia);                                    requestObj.open("POST",url,true);                   requestObj.setRequestHeader("Content-type", "application/x-www-form-urlencoded");                   requestObj.send(params);                   requestObj.onreadystatechange = function() {                     if (requestObj.readyState == 4) {                        if (requestObj.status == 200) {                              document.getElementById("ddatc").innerHTML = requestObj.responseText;                              //alert(requestObj.responseText);                        } else {                           alert(requestObj.statusText);                        }                     }                  }               }			function getSquadre(select){				var url = "getSquadre.php";				var e = document.getElementById("ddatc");				var requestObj = readyAJAX();				var strIdAtc =select.value;				var params = "id_atc="+encodeURIComponent(strIdAtc);				requestObj.open("POST",url,true);				requestObj.setRequestHeader("Content-type", "application/x-www-form-urlencoded");				requestObj.send(params);				requestObj.onreadystatechange = function() {					if (requestObj.readyState == 4) {						if (requestObj.status == 200) {							document.getElementById("ddsquadre").innerHTML = requestObj.responseText;							//alert(requestObj.responseText);						} else {							alert(requestObj.statusText);						}					}				}			}            </script>				          </body></html>